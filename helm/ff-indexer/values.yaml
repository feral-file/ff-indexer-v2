# Default values for ff-indexer
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  # Image registry for all images
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Common image settings
image:
  # Image repository - all services use the same repo with different tags
  repository: ff-indexer
  # Image pull policy
  pullPolicy: IfNotPresent
  # Default image tag - can be overridden per service
  tag: "latest"

# Application configuration
config:
  debug: true
  sentryDsn: ""
  
  # Ethereum configuration
  ethereum:
    chainId: "eip155:1"
    rpcUrl: ""  # Required for worker-core: Set your Ethereum RPC URL
    websocketUrl: ""  # Required for event-emitter: Ethereum WebSocket URL (e.g., wss://mainnet.infura.io/ws/v3/YOUR_KEY)
    startBlock: 0
    tokenSweepStartBlock: 10000000
  
  # Tezos configuration
  tezos:
    chainId: "tezos:mainnet"
    apiUrl: "https://api.tzkt.io"
    websocketUrl: "https://api.tzkt.io/v1/ws"
    startLevel: 0
    tokenSweepStartBlock: 5000000
  
  # Vendor configurations
  vendors:
    artblocksUrl: "https://artblocks-mainnet.hasura.app/v1/graphql"
    feralfileUrl: "https://feralfile.com/api"
  
  # Cloudflare configuration for media processing
  cloudflare:
    accountId: ""  # Required: Your Cloudflare account ID
    apiToken: ""   # Required: Your Cloudflare API token with Images/Stream permissions
  
  # NATS configuration for event emitters
  nats:
    streamName: "BLOCKCHAIN_EVENTS"
    maxReconnects: 10
    reconnectWait: "2s"
  
  # Worker configuration for event emitters
  worker:
    poolSize: 20
    queueSize: 1024
  
  # URI Gateways
  uri:
    ipfsGateways:
      - "https://ipfs.io"
      - "https://cloudflare-ipfs.com"
      - "https://ipfs.feralfile.com"
      - "https://dweb.link"
      - "https://ipfs.filebase.io"
    arweaveGateways:
      - "https://arweave.net"
    onchfsGateways:
      - "https://onchfs.fxhash2.xyz"
  
  # Authentication configuration
  auth:
    # JWT Public Key for Bearer token validation (RS256/RS384/RS512)
    jwtPublicKey: |
      -----BEGIN PUBLIC KEY-----
      MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0Z7hf+bJN8jTXuXa1234
      CHANGE_ME_WITH_YOUR_ACTUAL_RSA_PUBLIC_KEY_IN_PEM_FORMAT_HERE_THIS
      IS_JUST_A_PLACEHOLDER_AND_WILL_NOT_WORK_FOR_ACTUAL_AUTHENTICATION
      5678+abcd/efgh==
      -----END PUBLIC KEY-----
    # API Keys for ApiKey authentication
    apiKeys:
      - "api-key-1"
      - "api-key-2"

# PostgreSQL configuration for application database
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: postgres
    tag: "18-alpine"
  auth:
    username: postgres
    password: postgres
    database: ff_indexer
  
  # Database connection pool settings per service
  # Each service maintains its own pool based on workload
  connectionPool:
    # API server - higher pool for concurrent HTTP requests
    api:
      maxOpenConns: 40
      maxIdleConns: 10
      connMaxLifetime: "5m"
      connMaxIdleTime: "10m"
    # Worker core - medium pool for task processing
    workerCore:
      maxOpenConns: 30
      maxIdleConns: 8
      connMaxLifetime: "5m"
      connMaxIdleTime: "10m"
    # Worker media - lower pool for CPU/IO intensive work
    workerMedia:
      maxOpenConns: 10
      maxIdleConns: 5
      connMaxLifetime: "5m"
      connMaxIdleTime: "10m"
    # Event bridge - lower pool for event processing
    eventBridge:
      maxOpenConns: 20
      maxIdleConns: 5
      connMaxLifetime: "5m"
      connMaxIdleTime: "10m"
    # Event emitters - minimal pool for low workload writes
    # Connections can be kept longer due to minimal usage
    ethereumEventEmitter:
      maxOpenConns: 2
      maxIdleConns: 1
      connMaxLifetime: "30m"      # Longer lifetime - minimal workload
      connMaxIdleTime: "15m"      # Keep idle connections longer
    tezosEventEmitter:
      maxOpenConns: 2
      maxIdleConns: 1
      connMaxLifetime: "30m"      # Longer lifetime - minimal workload
      connMaxIdleTime: "15m"      # Keep idle connections longer
  primary:
    persistence:
      enabled: true
      size: 20Gi
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 2Gi
        cpu: 1000m
    initdb:
      scriptsConfigMap: postgresql-init-scripts
  service:
    type: ClusterIP
    ports:
      postgresql: 5432

# External Temporal configuration (deployed separately)
externalTemporal:
  # Temporal server host:port
  hostPort: "temporal:7233"
  # Temporal namespace
  namespace: "default"

# External NATS configuration (deployed separately)
externalNats:
  # NATS server URL
  url: "nats://nats:4222"

# API Server configuration
api:
  enabled: true
  image:
    tag: api  # Uses: ff-indexer:api
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8081
  ingress:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: ff-indexer-api.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
  resources:
    requests:
      memory: 256Mi
      cpu: 200m
    limits:
      memory: 1Gi
      cpu: 1000m
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  server:
    host: "0.0.0.0"
    port: 8081
    readTimeout: 15
    writeTimeout: 15
    idleTimeout: 120

# Ethereum Event Emitter configuration
ethereumEventEmitter:
  enabled: true
  image:
    tag: ethereum-event-emitter  # Uses: ff-indexer:ethereum-event-emitter
  replicaCount: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 200m
    limits:
      memory: 1Gi
      cpu: 1000m

# Tezos Event Emitter configuration
tezosEventEmitter:
  enabled: true
  image:
    tag: tezos-event-emitter  # Uses: ff-indexer:tezos-event-emitter
  replicaCount: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 200m
    limits:
      memory: 1Gi
      cpu: 1000m

# Event Bridge configuration
eventBridge:
  enabled: true
  image:
    tag: event-bridge  # Uses: ff-indexer:event-bridge
  replicaCount: 1
  resources:
    requests:
      memory: 256Mi
      cpu: 200m
    limits:
      memory: 1Gi
      cpu: 1000m

# Worker Core configuration
workerCore:
  enabled: true
  image:
    tag: worker-core  # Uses: ff-indexer:worker-core
  replicaCount: 2
  resources:
    requests:
      memory: 512Mi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 2000m
  temporal:
    taskQueue: "token-indexing"
    mediaTaskQueue: "media-indexing"
    maxConcurrentActivityExecutionSize: 50
    workerActivitiesPerSecond: 50
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 70

# Worker Media configuration
workerMedia:
  enabled: true
  image:
    tag: worker-media  # Uses: ff-indexer:worker-media
  replicaCount: 2
  resources:
    requests:
      memory: 512Mi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 2000m
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 70
  temporal:
    taskQueue: "token-indexing"
    mediaTaskQueue: "media-indexing"
    maxConcurrentActivityExecutionSize: 10
    workerActivitiesPerSecond: 10
  # Media file size limits (in bytes)
  maxStaticImageSize: 10485760    # 10MB
  maxAnimatedImageSize: 52428800  # 50MB
  maxVideoSize: 314572800          # 300MB

# Registry files (blacklist and publisher configurations)
registryFiles:
  blacklist: |
    {
      "contracts": []
    }
  publisher: |
    {
      "publishers": []
    }

# Service Account
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext:
  fsGroup: 1000

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Priority class name
priorityClassName: ""

